machine:
  php:
    version: 5.4.19
  hosts:
    drupal.dev: 127.0.0.1

general:
  artifacts:
    - "app/sites/default/files/simpletest/verbose"

dependencies:
  override:
    - wget https://github.com/drush-ops/drush/archive/master.zip
    - unzip master.zip
    - cd drush-master && composer install && ln -s `pwd`/drush /home/ubuntu/bin/drush

    # Disable this because of a bug in drush.
#    - composer global require drush/drush:dev-master

    - cp vhost /etc/apache2/sites-available/drupal
    - a2ensite drupal
    - a2enmod rewrite
    - sudo service apache2 restart
    - drush sql-create --db-url="mysql://root:@127.0.0.1/drupal" -y
    - drush si --db-url=mysql://root:@127.0.0.1/drupal install_configure_form.update_status_module='array(FALSE,FALSE)' -y
test:
  override:
    - sudo -u www-data php ./core/scripts/run-tests.sh --dburl mysql://root:@127.0.0.1/drupal --verbose --color --php /home/ubuntu/.phpenv/shims/php --concurrency 12 --url http://drupal.dev --all